sap.ui.define(["ui5/ogarpt/controller/BaseController","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/ui/model/odata/v2/ODataModel"],function(e,t,o,s){"use strict";var n={ZTYPE_MOVEMENT:"",Plant:"",VendorNumber:"",VendorName:"",ZFREIGHT_CHARGED_TO:"",ZFREIGHT_METHOD:"",PurchasingDoc:"",PoItem:"",MaterialDoc:"",MaterialItem:"",ZSTORED_ENERGY:"N",ZDANGEROUS_GOODS:"N",radianceClearance:"N",year:(new Date).getFullYear(),Date:(new Date).toLocaleDateString("de-DE"),VendorAddress1:"",VendorAddress2:"",VendorAddress3:"",ZGM3_CONTACT:"",ZGM3_TELEPHONE:"",ZGM3_FAX:"",ZGM3_EMAIL:"",ZCARRIER_NAME:"",plantAddress1:"",plantAddress2:"",plantAddress3:"",plantAddress4:"",ZVENDOR_CONTACT:"",ZVENDOR_TELEPHONE:"",ZVENDOR_FAX:"",ZVENDOR_EMAIL:"",ZCARRIER_CONSIGN:"",ZCARRIER_CONSIGN:"",NP_ASH2DLVTI:[],NP_ASH2DATES:[{Timetype:"WS GOODS ISSUE  LIKP",TimestampUtc:Math.floor((new Date).getTime()/1e3)}],NP_ASH2RETURN:[{}]};return e.extend("ui5.ogarpt.controller.Main",{onInit:function(){this.getView().setModel(new sap.ui.model.json.JSONModel(n),"submitData");const e=new s("/sap/opu/odata/sap/ZIM_OGA_SRV/");const t=this;e.read("/PLANTSet",{success:function(e){console.log("成功获取工厂数据:",e);t.getView().setModel(new sap.ui.model.json.JSONModel(e),"plantModel")},error:function(e){console.error("获取工厂数据失败:",e);sap.m.MessageToast.show("获取工厂数据失败: "+e.message)}});e.read("/VENDORSet",{success:function(e){console.log("成功获取GYS数据:",e);t.getView().setModel(new sap.ui.model.json.JSONModel(e),"VendorModel")},error:function(e){console.error("获取供应商数据失败:",e);sap.m.MessageToast.show("获取供应商数据失败: "+e.message)}});e.read("/MATNRSet",{success:function(e){console.log("成功获取物料数据:",e);t.getView().setModel(new sap.ui.model.json.JSONModel(e),"MaterialModel")},error:function(e){console.error("获取物料数据失败:",e);sap.m.MessageToast.show("获取物料数据失败: "+e.message)}})},onBeforeRendering:function(){const e=new Date;const o=new t({currentYear:e.getFullYear(),currentDate:e.getDate().toString().padStart(2,"0")+"."+(e.getMonth()+1).toString().padStart(2,"0")+"."+e.getFullYear()});this.getView().setModel(o,"dateModel");this.getView().setModel(new t({currentStep:1}),"formState");const s=this.getView().getModel();const n=s.createEntry("/HEADSet",{properties:{ZTYPE_MOVEMENT:""}});this.getView().setBindingContext(n)},onAfterRendering:function(){const e=this.getView().getModel();e.create("/HEADSet",{DistrChan:"10",Division:"00",DlvType:"LO",Salesorg:"1310",ShipPoint:"1310",ShipTo:"0001000155",ZTYPE_MOVEMENT:"1234567",ZGM3_CONTACT:"1234567",ZGM3_TELEPHONE:"1234567",NP_ASH2DLVTI:[{RefItem:"000010"}],NP_ASH2DATES:[{Timetype:"WS GOODS ISSUE  LIKP"}],NP_ASH2RETURN:[{}]},{success:function(e){console.log("HeaderData:",e)}.bind(this),error:function(e){console.error("Request failed",e)}})},onDisplayNotFound:function(){this.getRouter().getTargets().display("notFound",{fromTarget:"main"})},handleNavigate:function(e){const t=this.byId("navCon");const o=e.getSource().data("target");const s=this.getView().getModel("formState");const n=s.getProperty("/currentStep");if(o){if(o==="p2"){s.setProperty("/currentStep",2);t.to(this.byId(o),"slide")}else if(o==="p3"){this.byId("_IDGenXMLView1").byId("_IDGenSmartForm1").check().then(e=>{if(e.length===0){s.setProperty("/currentStep",3);t.to(this.byId(o),"slide")}})}}else{if(n){s.setProperty("/currentStep",n-1)}t.back()}},handleSubmit:function(){const e=this.getView().getModel();const t=this.getView().getModel("submitData");const o=t.getData();const s={DistrChan:"00",Division:"00",DlvType:"ZLO",Salesorg:"1310",ShipPoint:"AU99",ShipTo:o.VendorNumber,ZTYPE_MOVEMENT:o.ZTYPE_MOVEMENT||"1234567",ZGM3_CONTACT:o.ZGM3_CONTACT||"1234567",ZGM3_TELEPHONE:o.ZGM3_TELEPHONE||"1234567",NP_ASH2DLVTI:o.NP_ASH2DLVTI.map(e=>({RefItem:e.Vbeln||"",DlvQty:e.Quantity||"",Material:e.MaterialNo||"",SalesUnit:e.Unit1||"",Plant:o.Plant||""})),NP_ASH2DATES:[{Timetype:"WS GOODS ISSUE  LIKP",Timezone:"UTC+8",TimestampUtc:new Date}],NP_ASH2RETURN:[{}]};console.log("提交数据:",JSON.stringify(s,null,2));e.create("/HEADSet",s,{success:function(e){console.log("提交成功:",e);sap.m.MessageToast.show("Saved successfully!");t.setData({ZTYPE_MOVEMENT:"",Plant:"",VendorNumber:"",VendorName:"",ZFREIGHT_CHARGED_TO:"",ZFREIGHT_METHOD:"",PurchasingDoc:"",PoItem:"",MaterialDoc:"",MaterialItem:"",ZSTORED_ENERGY:"N",ZDANGEROUS_GOODS:"N",radianceClearance:"N",year:(new Date).getFullYear(),Date:(new Date).toLocaleDateString("de-DE"),VendorAddress1:"",VendorAddress2:"",VendorAddress3:"",VendorAddress4:"",ZGM3_CONTACT:"",ZGM3_TELEPHONE:"",ZGM3_FAX:"",ZGM3_EMAIL:"",ZCARRIER_NAME:"",plantAddress1:"",plantAddress2:"",plantAddress3:"",plantAddress4:"",ZVENDOR_CONTACT:"",ZVENDOR_TELEPHONE:"",ZVENDOR_FAX:"",ZVENDOR_EMAIL:"",ZCARRIER_CONSIGN:"",NP_ASH2DLVTI:[],NP_ASH2DATES:[{Timetype:"WS GOODS ISSUE  LIKP"}],NP_ASH2RETURN:[{}]});const o=this.getView().getModel("formState");o.setProperty("/currentStep",1);const s=this.byId("navCon");s.to(this.byId("p1"),"slide")}.bind(this),error:function(e){console.error("提交失败:",e);sap.m.MessageToast.show("保存失败："+e.message)}})}})});
//# sourceMappingURL=Main.controller.js.map